<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Chandhu Fitness Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;600&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  
  <style>
    :root {
      --primary: #ff3b3b;
      --bg: #050505;
      --card: #121212;
      --border: #222;
      --text: #eee;
      --whatsapp: #25d366;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      background: var(--bg); color: var(--text);
      font-family: 'Montserrat', sans-serif;
      min-height: 100vh;
      display: flex; flex-direction: column;
    }

    /* â”€â”€ LOGIN OVERLAY â”€â”€ */
    #login-overlay {
      position: fixed; inset: 0; background: #000; z-index: 9999;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
    }
    .login-box {
      background: var(--card); padding: 40px; border-radius: 20px; border: 1px solid var(--border);
      text-align: center; width: 85%; max-width: 320px;
    }
    .pin-input {
      width: 100%; padding: 15px; margin: 25px 0; background: #000; border: 1px solid #333;
      color: #fff; text-align: center; font-size: 1.5rem; letter-spacing: 8px; border-radius: 12px; outline: none;
    }
    .btn-main {
      width: 100%; padding: 15px; background: var(--primary); color: #fff; border: none;
      border-radius: 12px; font-weight: bold; cursor: pointer; font-family: 'Oswald', sans-serif; font-size: 1.1rem;
    }

    /* â”€â”€ HEADER & CONTROLS â”€â”€ */
    .header {
      position: sticky; top: 0; z-index: 100;
      background: rgba(5, 5, 5, 0.95);
      padding: 15px 20px; border-bottom: 1px solid var(--border);
      display: flex; flex-direction: column; gap: 15px;
    }

    .search-bar {
      width: 100%; padding: 12px 16px; border-radius: 12px;
      border: 1px solid #333; background: #111; color: white; font-size: 1rem; outline: none;
    }

    /* Filter Chips */
    .filters { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
    .filter-chip {
      padding: 8px 16px; background: #1a1a1a; border: 1px solid #333; border-radius: 20px;
      color: #888; font-size: 0.85rem; font-weight: 600; white-space: nowrap; cursor: pointer; transition: 0.2s;
    }
    .filter-chip.active { background: var(--primary); color: white; border-color: var(--primary); }

    /* â”€â”€ STATS â”€â”€ */
    .stats {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 20px;
    }
    .stat-card {
      background: var(--card); padding: 15px; border-radius: 14px; text-align: center; border: 1px solid var(--border);
    }
    .stat-val {
      font-family: 'Oswald', sans-serif; font-size: 1.5rem; font-weight: 600; margin-bottom: 4px; color: white;
    }
    .stat-label { font-size: 0.7rem; color: #888; text-transform: uppercase; }

    /* â”€â”€ TABLE / CARD LIST â”€â”€ */
    .content-wrapper { flex: 1; padding: 0 20px 40px; }
    
    table { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
    
    /* Desktop Headers */
    thead th {
      text-align: left; padding: 10px; color: #666; font-size: 0.8rem; text-transform: uppercase;
    }

    /* Rows */
    tbody tr {
      background: var(--card);
    }
    tbody td {
      padding: 15px; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border);
      color: #ccc; font-size: 0.95rem;
    }
    tbody tr td:first-child { border-left: 1px solid var(--border); border-top-left-radius: 12px; border-bottom-left-radius: 12px; }
    tbody tr td:last-child { border-right: 1px solid var(--border); border-top-right-radius: 12px; border-bottom-right-radius: 12px; }

    /* Badges */
    .badge { padding: 5px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; display: inline-block; }
    .b-active { background: rgba(0,255,136,0.1); color: #00ff88; }
    .b-soon { background: rgba(255,183,0,0.1); color: #ffb700; }
    .b-expired { background: rgba(255,59,59,0.1); color: #ff3b3b; }

    /* â”€â”€ MOBILE OPTIMIZATION â”€â”€ */
    @media (max-width: 768px) {
      /* Scrollable Stats */
      .stats { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; padding: 15px 20px; }
      .stat-card { min-width: 140px; scroll-snap-align: start; }

      /* Convert Table to Cards */
      thead { display: none; }
      tr { display: block; margin-bottom: 15px; border-radius: 16px; position: relative; border: 1px solid var(--border); padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
      
      td { display: block; padding: 0; border: none !important; }
      
      /* Layout the Card */
      /* 1. Name */
      td:nth-child(2) { font-size: 1.2rem; font-weight: 700; color: white; margin-bottom: 5px; padding-right: 50px; }
      /* 2. Plan & Phone */
      td:nth-child(4) { display: inline-block; color: var(--primary); font-weight: 600; font-size: 0.9rem; margin-right: 10px; }
      td:nth-child(3) { display: inline-block; color: #666; font-size: 0.9rem; }
      /* 3. Status Badge */
      td:nth-child(5) { margin-top: 10px; }
      /* 4. Date (Small top right) */
      td:nth-child(1) { position: absolute; top: 18px; right: 70px; font-size: 0.75rem; color: #555; }
      /* 5. WhatsApp Button (Floating Right) */
      td:nth-child(6) { position: absolute; top: 15px; right: 15px; }
      td:nth-child(6) a {
        display: flex; align-items: center; justify-content: center;
        width: 45px; height: 45px; background: #1a1a1a; border-radius: 50%;
        color: #25d366; font-size: 1.5rem; border: 1px solid #333;
      }
    }
  </style>
</head>
<body>

  <div id="login-overlay">
    <div class="login-box">
      <h2 style="font-family:'Oswald',sans-serif; margin-bottom:10px; color:var(--primary)">ADMIN ACCESS</h2>
      <input type="password" id="pin-input" class="pin-input" placeholder="****" maxlength="4" inputmode="numeric">
      <button class="btn-main" onclick="Auth.login()">UNLOCK</button>
      <p id="error-msg" style="color:var(--primary); margin-top:20px; font-size:0.9rem; display:none">Incorrect PIN</p>
    </div>
  </div>

  <div class="main">
    <header class="header">
      <input id="search" class="search-bar" placeholder="ðŸ” Search name or phone..." onkeyup="App.search()"/>
      
      <div class="filters">
        <div class="filter-chip active" onclick="App.filter('all', this)">All</div>
        <div class="filter-chip" onclick="App.filter('active', this)">Active</div>
        <div class="filter-chip" onclick="App.filter('soon', this)">Expiring Soon</div>
        <div class="filter-chip" onclick="App.filter('expired', this)">Expired</div>
      </div>
    </header>

    <div class="stats">
      <div class="stat-card">
        <div class="stat-val" style="color:var(--primary)">â‚¹<span id="stat-revenue">0</span></div>
        <div class="stat-label">Revenue</div>
      </div>
      <div class="stat-card">
        <div class="stat-val" id="stat-total">0</div>
        <div class="stat-label">Members</div>
      </div>
      <div class="stat-card">
        <div class="stat-val" style="color:#ffb700" id="stat-soon">0</div>
        <div class="stat-label">Expiring Soon</div>
      </div>
    </div>

    <div class="content-wrapper">
      <div id="loader" style="text-align:center; padding:40px; color:#666">Loading...</div>

      <table id="data-table" style="display:none">
        <thead>
          <tr>
            <th>Date</th>
            <th>Name</th>
            <th>Phone</th>
            <th>Plan</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="table-body"></tbody>
      </table>
    </div>
  </div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CONFIGURATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CONFIG = {
    // 1. PASTE YOUR GOOGLE SCRIPT URL HERE
    API_URL: "https://script.google.com/macros/s/AKfycbynxK5255t3pAmsCHsQegf1L_pS4bTICU9PeJPUvobGxty1Ld1jYO103b6woWGd7yVFpQ/exec",
    
    // 2. PIN HASH (Currently '1234')
    PIN_HASH: "03ac674216f3e15c761ee1a5e255f067953623c8b388b4459e13f978d7c846f4"
};

let DB = [];

const Auth = {
    async login() {
        const input = document.getElementById('pin-input').value;
        const hash = await this.sha256(input);
        if(hash === CONFIG.PIN_HASH) {
            document.getElementById('login-overlay').style.display = 'none';
            App.fetchData();
        } else {
            document.getElementById('error-msg').style.display = 'block';
        }
    },
    async sha256(str) {
        const buf = new TextEncoder().encode(str);
        const hash = await crypto.subtle.digest('SHA-256', buf);
        return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,'0')).join('');
    }
};

const App = {
  fetchData() {
    fetch(CONFIG.API_URL)
      .then(r => r.json())
      .then(data => {
        const rows = data.data.slice(1);
        DB = rows.filter(r => r[0] && r[1]).map(r => ({
          date: r[0],
          name: r[1],
          phone: r[2],
          plan: r[3],
          amount: parseInt(r[4]) || 0,
          days: parseInt(r[7]) || 0
        }));
        DB.sort((a,b) => new Date(b.date) - new Date(a.date));

        this.updateStats();
        this.render(DB);

        document.getElementById("loader").style.display = "none";
        document.getElementById("data-table").style.display = "table";
      })
      .catch(err => {
        document.getElementById("loader").innerHTML = "Error loading data.";
      });
  },

  updateStats() {
    document.getElementById("stat-revenue").innerText = DB.reduce((s, i) => s + i.amount, 0).toLocaleString();
    document.getElementById("stat-total").innerText = DB.length;
    document.getElementById("stat-soon").innerText = DB.filter(i => i.days >= 0 && i.days <= 7).length;
  },

  filter(type, btn) {
    document.querySelectorAll('.filter-chip').forEach(el => el.classList.remove('active'));
    btn.classList.add('active');
    
    let list = DB;
    if(type === 'active') list = DB.filter(i => i.days >= 0);
    else if(type === 'soon') list = DB.filter(i => i.days >= 0 && i.days <= 7);
    else if(type === 'expired') list = DB.filter(i => i.days < 0);
    
    this.render(list);
  },

  search() {
    const term = document.getElementById("search").value.toLowerCase().trim();
    const filtered = DB.filter(i =>
      i.name.toLowerCase().includes(term) ||
      (i.phone && i.phone.includes(term))
    );
    this.render(filtered);
  },

  render(list) {
    const tbody = document.getElementById("table-body");
    if(list.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6" style="text-align:center; padding:30px;">No records found</td></tr>`;
        return;
    }

    tbody.innerHTML = list.map(item => {
      let badge = "b-active";
      let status = `${item.days} Days Left`;

      if (item.days < 0) {
        badge = "b-expired";
        status = "Expired";
      } else if (item.days <= 7) {
        badge = "b-soon";
      }

      let dateStr = "N/A";
      try { dateStr = new Date(item.date).toLocaleDateString('en-IN', {day:'numeric', month:'short'}); } catch(e){}

      return `
      <tr>
        <td>${dateStr}</td>
        <td>${item.name}</td>
        <td>${item.phone || ""}</td>
        <td>${item.plan}</td>
        <td><span class="badge ${badge}">${status}</span></td>
        <td>
          ${item.phone ? `
            <a href="https://wa.me/91${item.phone}?text=Hello ${item.name}, your membership status: ${status}" target="_blank">
              <i class="fab fa-whatsapp"></i>
            </a>
          ` : ""}
        </td>
      </tr>`;
    }).join("");
  }
};
</script>
</body>
</html>
